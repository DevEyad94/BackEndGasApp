import{v as m}from"./chunk-ZGC3T5ZG.js";import{B as i,O as l,Wa as p,Za as f,h as a,m as u,s as c,y as h}from"./chunk-FWRIDW2Q.js";var j=(()=>{class s{http;baseUrl=m.apiUrl+"auth/";currentUserSource=new a(1);currentUser$=this.currentUserSource.asObservable();isBrowser;constructor(t,r){this.http=t,this.isBrowser=p(r),this.loadCurrentUser()}login(t){return this.http.post(this.baseUrl+"login",t).pipe(u(r=>{let e=r;return e.data&&(this.isBrowser&&localStorage.setItem("userInfo",JSON.stringify(e.data)),this.setCurrentUser(e.data)),r}))}loadCurrentUser(){if(!this.isBrowser){this.currentUserSource.next(null);return}let t=localStorage.getItem("userInfo");if(!t){this.currentUserSource.next(null);return}let r=JSON.parse(t);r.token&&!this.tokenExpired(r.token)?this.setCurrentUser(r):this.logout()}tokenExpired(t){try{let r=JSON.parse(atob(t.split(".")[1])).exp;return Math.floor(new Date().getTime()/1e3)>=r}catch{return!0}}logout(){this.isBrowser&&localStorage.removeItem("userInfo"),this.currentUserSource.next(null)}register(t){return this.http.post(this.baseUrl+"register",t)}setCurrentUser(t){this.currentUserSource.next(t)}isLoggedIn(){if(!this.isBrowser)return!1;let t=localStorage.getItem("userInfo");if(!t)return!1;let r=JSON.parse(t);return!!r.token&&!this.tokenExpired(r.token)}resetPassword(t){return this.http.post(this.baseUrl+"RestPassword",t)}changePassword(t){return this.http.post(this.baseUrl+"ChangePassword",t)}userExists(t){return this.http.get(this.baseUrl+"UserExists/"+t)}roleMatch(t){let r=!1;if(t){let e;this.currentUser$.pipe(c(1)).subscribe(o=>{e=o,e?.token&&t.forEach(g=>{let n=o?.role;n&&n.find(U=>U===g)&&(r=!0)})})}return r}static \u0275fac=function(r){return new(r||s)(i(f),i(l))};static \u0275prov=h({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{j as a};
//# sourceMappingURL=chunk-RCTVI3O5.js.map
