import './polyfills.server.mjs';
import{a as W,b as K,c as Q,d as X}from"./chunk-5VBOYX76.mjs";import{a as P,b as N,c as Y}from"./chunk-Y4S57LZT.mjs";import"./chunk-UR4KZO5S.mjs";import"./chunk-E44DUL6C.mjs";import{a as B,b as H,c as Z,d as J}from"./chunk-MHCTP4LA.mjs";import{b as z,c as h,d as V,e as O,f as q,h as G,i as A,j as L,n as j,p as U,r as $}from"./chunk-444SJH6C.mjs";import"./chunk-KLHXEL3F.mjs";import"./chunk-VORNBINK.mjs";import{Ab as T,Cb as M,Eb as S,Fa as r,Ka as x,Pa as F,Ua as f,ba as y,bb as l,ca as b,fb as i,gb as n,hb as c,kb as v,lb as p,mb as u,oc as w,pc as D,rb as o,rc as E,sb as _,sc as I,tb as m,tc as R,v as C,z as k}from"./chunk-IILPPODV.mjs";import"./chunk-OFHM46N5.mjs";var ee=s=>[s];function te(s,g){if(s&1){let e=v();i(0,"div",35)(1,"h2",36),o(2),n(),i(3,"form",37),p("ngSubmit",function(){y(e);let t=u();return b(t.onSubmit())}),c(4,"input",38),i(5,"div"),c(6,"app-label",12)(7,"app-date-picker",39),n(),i(8,"div"),c(9,"app-zsk-select",40),n(),i(10,"div"),c(11,"app-zsk-select",41),n(),i(12,"div"),c(13,"app-text-input",42),n(),i(14,"div",43),c(15,"app-text-area",44),n(),i(16,"div",45)(17,"button",46),p("click",function(){y(e);let t=u();return b(t.toggleForm())}),o(18," Cancel "),n(),i(19,"button",47),o(20),n()()()()}if(s&2){let e=u();r(2),m(" ",e.isEditMode?"Edit Maintenance Record":"Add Maintenance Record"," "),r(),l("formGroup",e.recordForm),r(3),l("label","Maintenance Date")("required",!0),r(),l("placeholder","Select date")("required",!0)("errorMessage","Date is required"),r(2),l("label","Maintenance Type")("required",!0)("placeholder","Select maintenance type")("options",e.getMaintenanceTypeOptions())("id","maintenance-type")("name","maintenance-type"),r(2),l("label","Field")("required",!0)("placeholder","Select field")("options",e.getFieldOptions())("id","field")("name","field"),r(2),l("label","Cost")("required",!0)("type","number")("placeholder","Enter cost")("id","cost")("name","cost")("errorMessage","Cost is required"),r(2),l("label","Description")("required",!0)("placeholder","Enter description")("id","description")("name","description")("rows",4)("errorMessage","Description is required"),r(4),l("disabled",e.recordForm.invalid||e.isSubmitting),r(),m(" ",e.isSubmitting?"Saving...":e.isEditMode?"Update":"Save"," ")}}function ie(s,g){if(s&1&&(i(0,"span",48),o(1),n()),s&2){let e=u();r(),m(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ne(s,g){if(s&1&&(i(0,"span",48),o(1),n()),s&2){let e=u();r(),m(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function re(s,g){if(s&1&&(i(0,"span",48),o(1),n()),s&2){let e=u();r(),m(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ae(s,g){if(s&1&&(i(0,"span",48),o(1),n()),s&2){let e=u();r(),m(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function oe(s,g){s&1&&(i(0,"tr",49)(1,"td",50),o(2," Loading... "),n()())}function le(s,g){s&1&&(i(0,"tr",51)(1,"td",50),o(2," No records found "),n()())}function se(s,g){if(s&1){let e=v();i(0,"button",58),p("click",function(){y(e);let t=u().$implicit,d=u();return b(d.deleteRecord(t))}),o(1," Delete "),n()}}function de(s,g){if(s&1){let e=v();i(0,"tr",51)(1,"td",52),o(2),M(3,"date"),n(),i(4,"td",53),o(5),n(),i(6,"td",52),o(7),n(),i(8,"td",52),o(9),M(10,"number"),n(),i(11,"td",54),o(12),n(),i(13,"td",55)(14,"button",56),p("click",function(){let t=y(e).$implicit,d=u();return b(d.editRecord(t))}),o(15," Edit "),n(),f(16,se,2,0,"button",57),n()()}if(s&2){let e=g.$implicit,a=u();r(2),m(" ",S(3,6,e.fieldMaintenanceDate,"MMM d, yyyy")," "),r(3),m(" ",e.fieldName," "),r(2),m(" ",e.maintenanceTypeName," "),r(2),m(" $",S(10,9,e.cost,"1.2-2")," "),r(3),m(" ",e.description," "),r(4),l("appHasRole",T(12,ee,a.roleEnum.ADMIN))}}var we=(()=>{class s{gasService;zskService;fb;toastService;Math=Math;roleEnum=N;maintenanceRecords=[];pagination={currentPage:1,itemsPerPage:10,totalItems:0,totalPages:0};fields=[];maintenanceTypes=[];recordForm;filterForm;isEditMode=!1;selectedRecord=null;isLoading=!1;isFormVisible=!1;isSubmitting=!1;sortColumn="fieldMaintenanceDate";sortDirection="desc";subscriptions=[];maintenanceTypeOptions=[];fieldOptions=[];showDeleteConfirmation=!1;recordToDelete=null;constructor(e,a,t,d){this.gasService=e,this.zskService=a,this.fb=t,this.toastService=d}ngOnInit(){this.initForms(),this.loadFilterOptions(),setTimeout(()=>{this.loadRecords()},100)}initForms(){this.recordForm=this.fb.group({fieldMaintenanceGuid:[""],fieldMaintenanceDate:["",h.required],cost:[0,[h.required,h.min(0)]],description:["",h.required],zMaintenanceTypeId:[null,h.required],zFieldId:[null,h.required]}),this.filterForm=this.fb.group({search:[""],startDate:[""],endDate:[""],zMaintenanceTypeId:[null],zFieldId:[null],minCost:[null],maxCost:[null]});let e=this.filterForm.valueChanges.pipe(k(500)).subscribe(()=>{this.pagination.currentPage=1,this.loadRecords()});this.subscriptions.push(e)}loadFilterOptions(){C({fields:this.zskService.getFields(),maintenanceTypes:this.zskService.getMaintenanceTypes()}).subscribe({next:e=>{this.fields=e.fields,this.maintenanceTypes=e.maintenanceTypes,this.maintenanceTypeOptions=this.maintenanceTypes.map(a=>({value:a.zMaintenanceTypeId,label:a.name})),this.fieldOptions=this.fields.map(a=>({value:a.zFieldId,label:a.name}))},error:e=>{console.error("Error fetching filter options:",e),this.toastService.error("Failed to load filter options. Please try again later.")}})}loadRecords(){this.isLoading=!0;let e=this.filterForm.value;this.gasService.getFieldMaintenancesWithFilter(e,this.pagination.currentPage,this.pagination.itemsPerPage).subscribe({next:a=>{this.pagination=a.pagination,this.maintenanceRecords=a.result.data||[],this.isLoading=!1},error:a=>{console.error("Error fetching maintenance records:",a),this.isLoading=!1,this.toastService.error("Failed to load maintenance records. Please try again later.")}})}onPageChange(e){this.pagination.currentPage=e,this.loadRecords()}onSort(e){this.sortColumn===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=e,this.sortDirection="asc"),this.loadRecords()}toggleForm(e=!1){this.isFormVisible=!this.isFormVisible,this.isFormVisible&&!this.isEditMode?this.resetForm():this.isFormVisible||this.resetForm()}resetForm(){this.recordForm.reset({fieldMaintenanceGuid:"",cost:0,description:"",zMaintenanceTypeId:null,zFieldId:null}),this.isEditMode=!1,this.selectedRecord=null}onSubmit(){if(this.recordForm.invalid){this.markFormGroupTouched(this.recordForm),this.toastService.warning("Please fill in all required fields correctly.");return}this.isSubmitting=!0;let e=this.recordForm.value;if(this.isEditMode&&this.selectedRecord){let a={fieldMaintenanceGuid:e.fieldMaintenanceGuid,fieldMaintenanceDate:e.fieldMaintenanceDate,cost:e.cost,description:e.description,zMaintenanceTypeId:e.zMaintenanceTypeId,zFieldId:e.zFieldId};this.gasService.updateFieldMaintenance(a).subscribe({next:()=>{this.onSubmitSuccess("Maintenance record updated successfully!")},error:t=>{console.error("Error updating maintenance record:",t),this.isSubmitting=!1,this.toastService.error("Failed to update maintenance record. Please try again.")}})}else{let a={fieldMaintenanceDate:e.fieldMaintenanceDate,cost:e.cost,description:e.description,zMaintenanceTypeId:e.zMaintenanceTypeId,zFieldId:e.zFieldId};this.gasService.addFieldMaintenance(a).subscribe({next:()=>{this.onSubmitSuccess("Maintenance record added successfully!")},error:t=>{console.error("Error adding maintenance record:",t),this.isSubmitting=!1,this.toastService.error("Failed to add maintenance record. Please try again.")}})}}onSubmitSuccess(e){this.loadRecords(),this.resetForm(),this.isFormVisible=!1,this.isSubmitting=!1,this.toastService.success(e)}editRecord(e){this.isEditMode=!0,this.selectedRecord=e,this.isFormVisible||(this.isFormVisible=!0),this.recordForm.patchValue({fieldMaintenanceGuid:e.fieldMaintenanceGuid,fieldMaintenanceDate:this.formatDateForInput(e.fieldMaintenanceDate),cost:e.cost,description:e.description,zMaintenanceTypeId:e.zMaintenanceTypeId,zFieldId:e.zFieldId})}showDeleteConfirmationDialog(e){this.recordToDelete=e,this.showDeleteConfirmation=!0}onConfirmDelete(){this.recordToDelete&&this.performDeleteRecord(this.recordToDelete),this.showDeleteConfirmation=!1,this.recordToDelete=null}onCancelDelete(){this.showDeleteConfirmation=!1,this.recordToDelete=null}deleteRecord(e){this.showDeleteConfirmationDialog(e)}performDeleteRecord(e){this.gasService.deleteFieldMaintenance(e.fieldMaintenanceGuid).subscribe({next:()=>{this.loadRecords(),this.toastService.success(`Maintenance record for ${e.fieldName} has been deleted.`)},error:a=>{console.error("Error deleting maintenance record:",a),this.toastService.error("Failed to delete maintenance record. Please try again.")}})}formatDateForInput(e){return new Date(e).toISOString().split("T")[0]}getFieldName(e){let a=this.fields.find(t=>t.zFieldId===e);return a?a.name:"Unknown"}getMaintenanceTypeName(e){let a=this.maintenanceTypes.find(t=>t.zMaintenanceTypeId===e);return a?a.name:"Unknown"}markFormGroupTouched(e){Object.values(e.controls).forEach(a=>{a.markAsTouched(),a instanceof q&&this.markFormGroupTouched(a)})}getMaintenanceTypeOptions(){return this.maintenanceTypeOptions}getFieldOptions(){return this.fieldOptions}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}static \u0275fac=function(a){return new(a||s)(x(X),x(J),x(U),x(Y))};static \u0275cmp=F({type:s,selectors:[["app-maintenance-records"]],decls:74,vars:40,consts:[[1,"p-4","bg-gray-50","dark:bg-gray-800","min-h-screen"],[1,"mb-6","flex","justify-between","items-center"],[1,"text-3xl","font-bold","text-gray-900","dark:text-white"],[1,"mt-1","text-gray-600","dark:text-gray-300"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-green-500",3,"click"],["class","bg-white dark:bg-gray-700 p-6 rounded-lg shadow mb-6",4,"ngIf"],[1,"bg-white","dark:bg-gray-700","p-4","rounded-lg","shadow","mb-6"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","lg:grid-cols-7","gap-4",3,"formGroup"],["formControlName","search",3,"label","placeholder"],["formControlName","zFieldId",3,"label","placeholder","options"],["formControlName","zMaintenanceTypeId",3,"label","placeholder","options"],[3,"label","required"],["formControlName","startDate",3,"placeholder"],["formControlName","endDate",3,"placeholder"],["formControlName","minCost",3,"label","type","placeholder"],["formControlName","maxCost",3,"label","type","placeholder"],[1,"bg-white","dark:bg-gray-700","rounded-lg","shadow","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-800"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider","cursor-pointer",3,"click"],["class","ml-1",4,"ngIf"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider"],[1,"bg-white","dark:bg-gray-700","divide-y","divide-gray-200","dark:divide-gray-600"],["class","animate-pulse",4,"ngIf"],["class","hover:bg-gray-100 dark:hover:bg-gray-600",4,"ngIf"],["class","hover:bg-gray-100 dark:hover:bg-gray-600",4,"ngFor","ngForOf"],[1,"px-6","py-3","flex","items-center","justify-between","border-t","border-gray-200","dark:border-gray-600"],[1,"text-sm","text-gray-700","dark:text-gray-300"],[1,"font-medium"],[1,"flex","space-x-2"],[1,"px-3","py-1","border","border-gray-300","rounded-md","text-gray-700","hover:bg-gray-50","dark:border-gray-600","dark:text-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],[3,"confirm","cancel","visible","title","message","confirmText","cancelText"],[1,"bg-white","dark:bg-gray-700","p-6","rounded-lg","shadow","mb-6"],[1,"text-xl","font-semibold","text-gray-800","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6",3,"ngSubmit","formGroup"],["type","hidden","formControlName","fieldMaintenanceGuid"],["formControlName","fieldMaintenanceDate",3,"placeholder","required","errorMessage"],["formControlName","zMaintenanceTypeId",3,"label","required","placeholder","options","id","name"],["formControlName","zFieldId",3,"label","required","placeholder","options","id","name"],["formControlName","cost",3,"label","required","type","placeholder","id","name","errorMessage"],[1,"md:col-span-2"],["formControlName","description",3,"label","required","placeholder","id","name","rows","errorMessage"],[1,"md:col-span-2","flex","justify-end"],["type","button",1,"mr-2","px-4","py-2","border","border-gray-300","text-gray-700","rounded-md","hover:bg-gray-50","dark:border-gray-600","dark:text-gray-300","dark:hover:bg-gray-600",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50",3,"disabled"],[1,"ml-1"],[1,"animate-pulse"],["colspan","6",1,"px-6","py-4","whitespace-nowrap","text-center","text-gray-500","dark:text-gray-300"],[1,"hover:bg-gray-100","dark:hover:bg-gray-600"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"px-6","py-4","text-sm","text-gray-500","dark:text-gray-300","max-w-xs","truncate"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-right","space-x-1"],[1,"px-3","py-1.5","text-xs","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500",3,"click"],["class","px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",3,"click",4,"appHasRole"],[1,"px-3","py-1.5","text-xs","bg-red-600","text-white","rounded-md","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-red-500",3,"click"]],template:function(a,t){a&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),o(4,"Maintenance Records"),n(),i(5,"p",3),o(6,"Manage gas field maintenance records"),n()(),i(7,"div")(8,"button",4),p("click",function(){return t.toggleForm()}),o(9),n()()(),f(10,te,21,35,"div",5),i(11,"div",6)(12,"h2",7),o(13,"Filter Records"),n(),i(14,"form",8)(15,"div"),c(16,"app-text-input",9),n(),i(17,"div"),c(18,"app-zsk-select",10),n(),i(19,"div"),c(20,"app-zsk-select",11),n(),i(21,"div"),c(22,"app-label",12)(23,"app-date-picker",13),n(),i(24,"div"),c(25,"app-label",12)(26,"app-date-picker",14),n(),i(27,"div"),c(28,"app-text-input",15),n(),i(29,"div"),c(30,"app-text-input",16),n()()(),i(31,"div",17)(32,"div",18)(33,"table",19)(34,"thead",20)(35,"tr")(36,"th",21),p("click",function(){return t.onSort("fieldMaintenanceDate")}),o(37," Date "),f(38,ie,2,1,"span",22),n(),i(39,"th",21),p("click",function(){return t.onSort("fieldName")}),o(40," Field "),f(41,ne,2,1,"span",22),n(),i(42,"th",21),p("click",function(){return t.onSort("maintenanceTypeName")}),o(43," Type "),f(44,re,2,1,"span",22),n(),i(45,"th",21),p("click",function(){return t.onSort("cost")}),o(46," Cost "),f(47,ae,2,1,"span",22),n(),i(48,"th",23),o(49," Description "),n(),i(50,"th",24),o(51," Actions "),n()()(),i(52,"tbody",25),f(53,oe,3,0,"tr",26)(54,le,3,0,"tr",27)(55,de,17,14,"tr",28),n()()(),i(56,"div",29)(57,"div",30),o(58," Showing "),i(59,"span",31),o(60),n(),o(61," to "),i(62,"span",31),o(63),n(),o(64," of "),i(65,"span",31),o(66),n(),o(67," results "),n(),i(68,"div",32)(69,"button",33),p("click",function(){return t.onPageChange(t.pagination.currentPage-1)}),o(70," Previous "),n(),i(71,"button",33),p("click",function(){return t.onPageChange(t.pagination.currentPage+1)}),o(72," Next "),n()()()(),i(73,"app-confirm-dialog",34),p("confirm",function(){return t.onConfirmDelete()})("cancel",function(){return t.onCancelDelete()}),n()()),a&2&&(r(9),m(" ",t.isFormVisible?"Cancel":"Add New Maintenance"," "),r(),l("ngIf",t.isFormVisible),r(4),l("formGroup",t.filterForm),r(2),l("label","Search")("placeholder","Search..."),r(2),l("label","Field")("placeholder","All fields")("options",t.getFieldOptions()),r(2),l("label","Maintenance Type")("placeholder","All types")("options",t.getMaintenanceTypeOptions()),r(2),l("label","Start Date")("required",!0),r(),l("placeholder","Select start date"),r(2),l("label","End Date")("required",!0),r(),l("placeholder","Select end date"),r(2),l("label","Min Cost")("type","number")("placeholder","Min"),r(2),l("label","Max Cost")("type","number")("placeholder","Max"),r(8),l("ngIf",t.sortColumn==="fieldMaintenanceDate"),r(3),l("ngIf",t.sortColumn==="fieldName"),r(3),l("ngIf",t.sortColumn==="maintenanceTypeName"),r(3),l("ngIf",t.sortColumn==="cost"),r(6),l("ngIf",t.isLoading),r(),l("ngIf",!t.isLoading&&(!t.maintenanceRecords||t.maintenanceRecords.length===0)),r(),l("ngForOf",t.maintenanceRecords),r(5),_((t.pagination.currentPage-1)*t.pagination.itemsPerPage+1),r(3),_(t.Math.min(t.pagination.currentPage*t.pagination.itemsPerPage,t.pagination.totalItems)),r(3),_(t.pagination.totalItems),r(3),l("disabled",t.pagination.currentPage===1),r(2),l("disabled",t.pagination.currentPage===t.pagination.totalPages),r(2),l("visible",t.showDeleteConfirmation)("title","Confirm Delete")("message",t.recordToDelete?"Are you sure you want to delete this maintenance record for "+t.recordToDelete.fieldName+"?":"Are you sure you want to delete this record?")("confirmText","Delete")("cancelText","Cancel"))},dependencies:[R,w,D,I,E,$,G,z,V,O,j,A,L,H,W,K,B,Z,Q,P],styles:[`.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.max-w-xs[_ngcontent-%COMP%]{max-width:20rem}.truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media (max-width: 768px){.whitespace-nowrap[_ngcontent-%COMP%]{white-space:normal}}
/*# sourceMappingURL=maintenance-records.component-VZVUNS5G.css.map */`]})}return s})();export{we as MaintenanceRecordsComponent};
//# sourceMappingURL=chunk-VGTCR6CF.mjs.map
