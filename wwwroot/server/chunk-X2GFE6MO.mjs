import './polyfills.server.mjs';
import{a as fe,b as he,c as ve,d as _e,e as Ce,f as xe}from"./chunk-HQZUADLH.mjs";import{a as D,b as le,c as se,d as de,e as pe,f as ce,g as me,h as ue,i as ge}from"./chunk-KJO6H6AN.mjs";import{b as ee,c as te,d as I,e as G,f as ie,i as re,j as k,k as ne,p as oe,u as ae,v as P}from"./chunk-ZCT4NI3P.mjs";import{Ca as H,E as v,F as _,Fa as p,G as O,Ga as N,Ha as c,Ja as Z,K as j,Ka as Y,La as y,Na as s,Oa as d,Pa as R,Pb as K,Tb as W,Ub as X,W as M,Yb as J,Z as i,_b as $,ac as T,ba as E,bc as w,da as A,ha as C,k as V,pa as l,pb as Q,qa as q,rb as F,sa as o,t as z,ta as a,ua as g,ub as S,xa as L,ya as h,za as u}from"./chunk-F43LKXAA.mjs";import{a as B,b as U}from"./chunk-3H7LSQ57.mjs";var Fe=r=>({"border-red-500":r}),be=r=>({requiredLength:r}),Se=r=>({min:r}),Te=r=>({max:r});function we(r,f){r&1&&(O(),o(0,"svg",7),g(1,"circle",8)(2,"line",9),a())}function Ge(r,f){r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2&&(i(),c(" ",d(2,1,"VALIDATION.REQUIRED")," "))}function ke(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2){let e=u(2);i(),c(" ",R(2,1,"VALIDATION.MIN_LENGTH",y(4,be,e.formControl==null||e.formControl.errors==null||e.formControl.errors.minlength==null?null:e.formControl.errors.minlength.requiredLength))," ")}}function Pe(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2){let e=u(2);i(),c(" ",R(2,1,"VALIDATION.MAX_LENGTH",y(4,be,e.formControl==null||e.formControl.errors==null||e.formControl.errors.maxlength==null?null:e.formControl.errors.maxlength.requiredLength))," ")}}function De(r,f){r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2&&(i(),c(" ",d(2,1,"VALIDATION.EMAIL")," "))}function Ve(r,f){r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2&&(i(),c(" ",d(2,1,"VALIDATION.PATTERN")," "))}function Le(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2){let e=u(2);i(),c(" ",R(2,1,"VALIDATION.MIN",y(4,Se,e.formControl==null||e.formControl.errors==null||e.formControl.errors.min==null?null:e.formControl.errors.min.min))," ")}}function Ne(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2){let e=u(2);i(),c(" ",R(2,1,"VALIDATION.MAX",y(4,Te,e.formControl==null||e.formControl.errors==null||e.formControl.errors.max==null?null:e.formControl.errors.max.max))," ")}}function Be(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),a()),r&2){let e=u(2);i(),c(" ",d(2,1,e.errorMessage)," ")}}function Ue(r,f){if(r&1&&(o(0,"div",10),C(1,Ge,3,3,"span",11)(2,ke,3,6,"span",11)(3,Pe,3,6,"span",11)(4,De,3,3,"span",11)(5,Ve,3,3,"span",11)(6,Le,3,6,"span",11)(7,Ne,3,6,"span",11)(8,Be,3,3,"span",11),a()),r&2){let e=u();i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.required),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.minlength),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.maxlength),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.email),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.pattern),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.min),i(),l("ngIf",e.formControl==null||e.formControl.errors==null?null:e.formControl.errors.max),i(),l("ngIf",e.errorMessage&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.required)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.minlength)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.maxlength)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.email)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.pattern)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.min)&&!(!(e.formControl==null||e.formControl.errors==null)&&e.formControl.errors.max))}}var Ee=(()=>{class r{placeholder="";label="";required=!1;type="text";id="";name="";errorMessage="";showError=!1;inputMode="text";formControl;valueChanged=new j;value="";onChange=()=>{};onTouched=()=>{};constructor(){}ngOnInit(){}onInputChange(e){let n=e.target;this.value=n.value,this.valueChanged.emit(this.value),this.onChange(this.value),this.onTouched()}writeValue(e){this.value=e||""}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){e?this.formControl.disable():this.formControl.enable()}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=A({type:r,selectors:[["app-text-input"]],inputs:{placeholder:"placeholder",label:"label",required:"required",type:"type",id:"id",name:"name",errorMessage:"errorMessage",showError:"showError",inputMode:"inputMode",formControl:"formControl"},outputs:{valueChanged:"valueChanged"},features:[Z([{provide:ee,useExisting:z(()=>r),multi:!0}])],decls:8,vars:15,consts:[[1,"relative"],[3,"label","required","for"],[1,"input-container"],[1,"text-input"],["class","input-icon","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",4,"ngIf"],[1,"w-full","px-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","focus:outline-none","focus:ring-arabic-green","focus:border-arabic-green","dark:bg-gray-700","dark:text-white",3,"input","blur","type","id","name","placeholder","ngClass","formControl"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"input-icon"],["cx","11","cy","11","r","8"],["x1","21","y1","21","x2","16.65","y2","16.65"],[1,"mt-1","text-sm","text-red-600"],[4,"ngIf"]],template:function(n,t){n&1&&(o(0,"div",0),g(1,"app-label",1),o(2,"div",2)(3,"div",3),C(4,we,3,0,"svg",4),o(5,"input",5),s(6,"translate"),h("input",function(x){return t.onInputChange(x)})("blur",function(){return t.onTouched()}),a()()(),C(7,Ue,9,8,"div",6),a()),n&2&&(i(),l("label",t.label)("required",t.required)("for",t.id),i(3),l("ngIf",t.type==="search"),i(),l("type",t.type)("id",t.id)("name",t.name)("placeholder",d(6,11,t.placeholder))("ngClass",y(13,Fe,t.formControl==null?null:t.formControl.errors))("formControl",t.formControl),i(2),l("ngIf",t.formControl))},dependencies:[S,Q,F,ae,te,G,P,k,w,T,D],styles:[`.relative[_ngcontent-%COMP%]{position:relative}.input-container[_ngcontent-%COMP%]{cursor:text;margin-bottom:.5rem}.text-input[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;width:100%;position:relative}.input-icon[_ngcontent-%COMP%]{position:absolute;left:12px;width:20px;height:20px;color:var(--gray-500)}input[_ngcontent-%COMP%]{flex:1;transition:border-color .2s ease,box-shadow .2s ease}input[_ngcontent-%COMP%]:hover{border-color:var(--gray-400)}input[_ngcontent-%COMP%]:focus{border-color:var(--arabic-green);box-shadow:0 0 0 2px rgba(var(--arabic-green-rgb),.2)}input[_ngcontent-%COMP%]:disabled{background-color:var(--gray-100);cursor:not-allowed;opacity:.7}input[type=search][_ngcontent-%COMP%]{padding-left:2.5rem}.border-red-500[_ngcontent-%COMP%]{border-color:var(--red-500)!important}.border-red-500[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px rgba(var(--red-500-rgb),.2)}[dir=rtl][_nghost-%COMP%]   .text-input[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .text-input[_ngcontent-%COMP%]{flex-direction:row-reverse}[dir=rtl][_nghost-%COMP%]   .input-icon[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .input-icon[_ngcontent-%COMP%]{left:auto;right:12px}[dir=rtl][_nghost-%COMP%]   input[type=search][_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   input[type=search][_ngcontent-%COMP%]{padding-left:.75rem;padding-right:2.5rem}.dark[_nghost-%COMP%]   input[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--gray-800);color:var(--gray-100);border-color:var(--gray-700)}.dark[_nghost-%COMP%]   input[_ngcontent-%COMP%]:hover, .dark   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:hover{border-color:var(--gray-600)}.dark[_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus, .dark   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:var(--arabic-green)}.dark[_nghost-%COMP%]   input[_ngcontent-%COMP%]:disabled, .dark   [_nghost-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:var(--gray-900)}.dark[_nghost-%COMP%]   .input-icon[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .input-icon[_ngcontent-%COMP%]{color:var(--gray-400)}.dark[_nghost-%COMP%]   .border-red-500[_ngcontent-%COMP%], .dark   [_nghost-%COMP%]   .border-red-500[_ngcontent-%COMP%]{border-color:var(--red-400)!important}
/*# sourceMappingURL=text-input.component-POGB7RTS.css.map */`]})}return r})();var ze=()=>["/grave/management"];function je(r,f){r&1&&(o(0,"div",10),g(1,"div",11),o(2,"p",12),p(3),s(4,"translate"),a()()),r&2&&(i(3),c(" ",d(4,1,"SEARCH.LOADING")," "))}function qe(r,f){if(r&1&&(o(0,"div",13)(1,"p",14),p(2),a()()),r&2){let e=u();i(2),N(e.error)}}function He(r,f){if(r&1&&(o(0,"div",15)(1,"p",14),p(2),s(3,"translate"),s(4,"translate"),a()()),r&2){let e=u();i(2),c(" ",e.isEditMode?d(3,1,"GRAVE_FORM.EDIT_SUCCESS"):d(4,3,"GRAVE_FORM.CREATE_SUCCESS")," ")}}function Ze(r,f){if(r&1&&(o(0,"div",61),g(1,"img",62),a()),r&2){let e=u(2);i(),l("src",e.deathCertificatePreviewUrl,M)}}function Ye(r,f){if(r&1&&(o(0,"div",61),g(1,"img",63),a()),r&2){let e=u(2);i(),l("src",e.bodyReceiptCertificatePreviewUrl,M)}}function Qe(r,f){if(r&1&&(o(0,"div",61),g(1,"img",64),a()),r&2){let e=u(2);i(),l("src",e.previewUrl,M)}}function Ke(r,f){r&1&&(o(0,"div",65)(1,"div",66),g(2,"div",67),o(3,"p",68),p(4),s(5,"translate"),a()()()),r&2&&(i(4),c(" ",d(5,1,"GRAVE_FORM.LOADING_MAP")," "))}function We(r,f){if(r&1){let e=L();o(0,"div",69)(1,"google-map",70),h("mapClick",function(t){v(e);let m=u(2);return _(m.onMapClick(t))}),o(2,"map-advanced-marker",71),h("mapDragend",function(t){v(e);let m=u(2);return _(m.onMarkerDragEnd(t))}),a()(),o(3,"button",72),s(4,"translate"),h("click",function(){v(e);let t=u(2);return _(t.useCurrentLocation())}),O(),o(5,"svg",73),g(6,"path",74)(7,"path",75),a()()()}if(r&2){let e=u(2);i(),l("center",e.center)("zoom",e.zoom)("options",e.mapOptions),i(),l("position",e.markerPosition)("title","Location"),i(),H("title",d(4,6,"GRAVE_FORM.USE_CURRENT_LOCATION"))}}function Xe(r,f){if(r&1&&(o(0,"span"),p(1),s(2,"translate"),s(3,"translate"),a()),r&2){let e=u(2);i(),N(e.isEditMode?d(2,1,"GRAVE_FORM.UPDATE"):d(3,3,"GRAVE_FORM.SAVE"))}}function Je(r,f){r&1&&(o(0,"span",76),g(1,"span",77),p(2),s(3,"translate"),a()),r&2&&(i(2),c(" ",d(3,1,"GRAVE_FORM.SAVING")," "))}function $e(r,f){if(r&1){let e=L();o(0,"div",16)(1,"form",17),h("ngSubmit",function(){v(e);let t=u();return _(t.onSubmit())}),o(2,"div")(3,"h2",18),p(4),s(5,"translate"),a(),o(6,"div",19)(7,"div"),g(8,"app-text-input",20),a(),o(9,"div"),g(10,"app-gender",21),a(),o(11,"div"),g(12,"app-zone",22),a(),o(13,"div"),g(14,"app-grave-type",23),a()()(),o(15,"div")(16,"h2",18),p(17),s(18,"translate"),a(),o(19,"div",19)(20,"div"),g(21,"app-text-input",24),a(),o(22,"div"),g(23,"app-text-input",25),a()()(),o(24,"div")(25,"h2",18),p(26),s(27,"translate"),a(),o(28,"div",19)(29,"div"),g(30,"app-label",26),s(31,"translate"),g(32,"app-date-picker",27),s(33,"translate"),a(),o(34,"div"),g(35,"app-label",28),s(36,"translate"),g(37,"app-date-picker",29),s(38,"translate"),a()()(),o(39,"div")(40,"h2",18),p(41),s(42,"translate"),a(),o(43,"div"),g(44,"app-text-area",30),a(),o(45,"div",31),g(46,"app-text-area",32),a()(),o(47,"div")(48,"h2",18),p(49),s(50,"translate"),a(),o(51,"div",19)(52,"div")(53,"label",33),p(54),s(55,"translate"),a(),o(56,"label",34),p(57),s(58,"translate"),a(),o(59,"label",35),p(60),s(61,"translate"),o(62,"input",36),h("change",function(t){v(e);let m=u();return _(m.onDeathCertificateFileSelected(t))}),a()(),o(63,"p",37),p(64),s(65,"translate"),a(),C(66,Ze,2,1,"div",38),o(67,"label",39),p(68),s(69,"translate"),a(),o(70,"label",40),p(71),s(72,"translate"),o(73,"input",41),h("change",function(t){v(e);let m=u();return _(m.onBodyReceiptCertificateFileSelected(t))}),a()(),o(74,"p",37),p(75),s(76,"translate"),a(),C(77,Ye,2,1,"div",38),o(78,"label",42),p(79),s(80,"translate"),a(),o(81,"label",43),p(82),s(83,"translate"),o(84,"input",44),h("change",function(t){v(e);let m=u();return _(m.onFileSelected(t))}),a()(),o(85,"p",37),p(86),s(87,"translate"),a(),C(88,Qe,2,1,"div",38),a()()(),o(89,"div")(90,"h2",18),p(91),s(92,"translate"),a(),o(93,"div",45)(94,"p",46),p(95),s(96,"translate"),a(),o(97,"div",47)(98,"div",48)(99,"app-text-input",49),h("keyup.enter",function(){v(e);let t=u();return _(t.searchLocation(t.locationSearch.value))}),a()(),o(100,"button",50),h("click",function(){v(e);let t=u();return _(t.searchLocation(t.locationSearch.value))}),p(101),s(102,"translate"),a()(),C(103,Ke,6,3,"div",51)(104,We,8,8,"div",52),o(105,"div",53)(106,"div")(107,"app-text-input",54),s(108,"translate"),h("change",function(){v(e);let t=u();return _(t.updateMapFromInputs())}),a()(),o(109,"div")(110,"app-text-input",55),s(111,"translate"),h("change",function(){v(e);let t=u();return _(t.updateMapFromInputs())}),a()()()()(),o(112,"div",56)(113,"a",57),p(114),s(115,"translate"),a(),o(116,"button",58),C(117,Xe,4,5,"span",59)(118,Je,4,3,"span",60),a()()()()}if(r&2){let e=u();i(),l("formGroup",e.graveForm),i(3),c(" ",d(5,74,"GRAVE_FORM.BASIC_INFO")," "),i(4),l("label","GRAVE_FORM.GRAVE_REF")("placeholder","GRAVE_FORM.AUTOGENERATE_GRAVE_REF")("formControl",e.graveForm.controls.refID),i(2),l("required",!0)("formControl",e.graveForm.controls.zGenderId),i(2),l("required",!0)("formControl",e.graveForm.controls.zZoneId),i(2),l("required",!0)("formControl",e.graveForm.controls.zGraveTypeId),i(3),c(" ",d(18,76,"GRAVE_FORM.FULL_NAME")," "),i(4),l("label","GRAVE_FORM.NAME_EN")("required",!0)("placeholder","GRAVE_FORM.FULLNAME_EN")("formControl",e.graveForm.controls.fullNameEn),i(2),l("label","GRAVE_FORM.NAME_AR")("required",!0)("placeholder","GRAVE_FORM.FULLNAME_AR")("formControl",e.graveForm.controls.fullNameAr),i(3),c(" ",d(27,78,"GRAVE_FORM.DATES")," "),i(4),l("label",d(31,80,"GRAVE_FORM.DATE_OF_BIRTH")),i(2),l("formControl",e.graveForm.controls.dateOfBirth)("placeholder",d(33,82,"DATE_PICKER.SELECT_DATE")),i(3),l("label",d(36,84,"GRAVE_FORM.DATE_OF_DEATH"))("required",!0),i(2),l("required",!0)("formControl",e.graveForm.controls.dateOfDeath)("placeholder",d(38,86,"DATE_PICKER.SELECT_DATE")),i(4),c(" ",d(42,88,"GRAVE_FORM.DESCRIPTION")," "),i(3),l("label","GRAVE_FORM.DESCRIPTION_LABEL")("rows",4)("formControl",e.graveForm.controls.description)("placeholder","GRAVE_FORM.DESCRIPTION_PLACEHOLDER"),i(2),l("label","GRAVE_FORM.DESCRIPTION_EN_LABEL")("rows",4)("formControl",e.graveForm.controls.descriptionEn)("placeholder","GRAVE_FORM.DESCRIPTION_EN_PLACEHOLDER"),i(3),c(" ",d(50,90,"GRAVE_FORM.IMAGE")," "),i(5),c(" ",d(55,92,"GRAVE_FORM.UPLOAD_IMAGE")," "),i(3),c(" ",d(58,94,"GRAVE_FORM.UPLOAD_DEATH_CERTIFICATE")," "),i(3),c(" ",d(61,96,"GRAVE_FORM.CHOOSE_FILE")," "),i(4),c(" ",d(65,98,"GRAVE_FORM.IMAGE_REQUIREMENTS")," "),i(2),l("ngIf",e.deathCertificatePreviewUrl),i(2),c(" ",d(69,100,"GRAVE_FORM.UPLOAD_BODY_RECEIPT_CERTIFICATE")," "),i(3),c(" ",d(72,102,"GRAVE_FORM.CHOOSE_FILE")," "),i(4),c(" ",d(76,104,"GRAVE_FORM.IMAGE_REQUIREMENTS")," "),i(2),l("ngIf",e.bodyReceiptCertificatePreviewUrl),i(2),c(" ",d(80,106,"GRAVE_FORM.GRAVE_IMAGE")," "),i(3),c(" ",d(83,108,"GRAVE_FORM.CHOOSE_FILE")," "),i(4),c(" ",d(87,110,"GRAVE_FORM.IMAGE_REQUIREMENTS")," "),i(2),l("ngIf",e.previewUrl),i(3),c(" ",d(92,112,"GRAVE_FORM.LOCATION")," "),i(4),c(" ",d(96,114,"GRAVE_FORM.LOCATION_INSTRUCTIONS")," "),i(4),l("placeholder","GRAVE_FORM.SEARCH_LOCATION")("formControl",e.locationSearch),i(2),c(" ",d(102,116,"GRAVE_FORM.SEARCH")," "),i(2),l("ngIf",!e.apiLoaded),i(),l("ngIf",e.apiLoaded),i(3),l("label",d(108,118,"GRAVE_FORM.LATITUDE"))("formControl",e.graveForm.controls.latitude)("type","number"),i(3),l("label",d(111,120,"GRAVE_FORM.LONGITUDE"))("formControl",e.graveForm.controls.longitude)("type","number"),i(3),q("opacity-50",e.loading)("pointer-events-none",e.loading),l("routerLink",Y(124,ze)),i(),c(" ",d(115,122,"GRAVE_FORM.CANCEL")," "),i(2),l("disabled",e.loading||e.graveForm.invalid),i(),l("ngIf",!e.loading),i(),l("ngIf",e.loading)}}var St=(()=>{class r{fb;route;router;graveService;zskService;mapsApiService;translate;toast;graveForm;isEditMode=!1;graveId;loading=!1;submitted=!1;error=null;success=!1;genders=[];zones=[];relationships=[];graveTypes=[];locationSearch=new me(void 0);selectedFile=null;previewUrl=null;selectedDeathCertificateFile=null;deathCertificatePreviewUrl=null;selectedBodyReceiptCertificateFile=null;bodyReceiptCertificatePreviewUrl=null;center={lat:23.60929544,lng:58.59319553};zoom=20;markerPosition={lat:23.60929544,lng:58.59319553};markerOptions={draggable:!0};mapOptions={mapTypeId:"satellite",zoomControl:!0,scrollwheel:!0,disableDoubleClickZoom:!1,maxZoom:20,minZoom:8,mapId:"GRAVE_MAP"};apiLoaded=!1;constructor(e,n,t,m,x,b,Ie,ye){this.fb=e,this.route=n,this.router=t,this.graveService=m,this.zskService=x,this.mapsApiService=b,this.translate=Ie,this.toast=ye}ngOnInit(){this.initForm(),this.loadLookups(),this.loadGoogleMaps(),this.route.params.subscribe(e=>{e.id&&e.id!=="new"&&(this.isEditMode=!0,this.graveId=e.id,this.graveId&&this.loadGraveData(this.graveId))})}initForm(){this.graveForm=this.fb.group({graveId:this.fb.control(void 0),refID:this.fb.control({value:void 0,disabled:!0}),fullNameEn:this.fb.control(void 0,[I.required]),fullNameAr:this.fb.control(void 0,[I.required]),dateOfBirth:this.fb.control(void 0),dateOfDeath:this.fb.control(void 0,[I.required]),description:this.fb.control(void 0),descriptionEn:this.fb.control(void 0),latitude:this.fb.control(this.markerPosition.lat),longitude:this.fb.control(this.markerPosition.lng),zGenderId:this.fb.control(void 0,[I.required]),zZoneId:this.fb.control(void 0,[I.required]),zGraveTypeId:this.fb.control(void 0,[I.required])}),this.graveForm.markAsTouched(),this.graveForm.markAsDirty()}test(){}loadLookups(){this.loading=!0,V({genders:this.zskService.getGender(),zones:this.zskService.getZone(),graveTypes:this.zskService.getGraveType()}).subscribe({next:e=>{this.genders=e.genders.data,this.zones=e.zones.data,this.graveTypes=e.graveTypes.data,this.loading=!1},error:e=>{console.error("Error loading lookups:",e),this.error="Failed to load necessary data. Please try again.",this.loading=!1,this.loadMockLookups()}})}loadMockLookups(){V({genders:this.zskService.getGender(),zones:this.zskService.getZone(),relationships:this.zskService.getRelationship(),graveTypes:this.zskService.getGraveType()}).subscribe({next:e=>{this.genders=e.genders.data,this.zones=e.zones.data,this.relationships=e.relationships.data,this.graveTypes=e.graveTypes.data}})}loadGraveData(e){this.loading=!0,this.graveService.getGraveById(e).subscribe({next:n=>{if(n.success&&n.data){let t=n.data;this.graveForm.patchValue({refID:t.refID,fullNameEn:t.fullNameEn,fullNameAr:t.fullNameAr,dateOfBirth:t.dateOfBirth||void 0,dateOfDeath:t.dateOfDeath||void 0,description:t.description||"",descriptionEn:t.descriptionEn||"",latitude:t.latitude,longitude:t.longitude,zGenderId:t.zGender?.zGenderId,zZoneId:t.zZone?.zZoneId,zGraveTypeId:t.zGraveType?.zGraveTypeId}),t.latitude&&t.longitude&&(this.center={lat:t.latitude,lng:t.longitude},this.markerPosition={lat:t.latitude,lng:t.longitude},this.apiLoaded&&google&&google.maps&&(this.markerOptions=U(B({},this.markerOptions),{animation:google.maps.Animation.DROP}))),t.imageURLBase64&&(this.previewUrl="data:image/jpg;base64,"+t.imageURLBase64),t.deathCertificateImageURLBase64&&(this.deathCertificatePreviewUrl="data:image/jpg;base64,"+t.deathCertificateImageURLBase64),t.bodyReceiptCertificateImageURLBase64&&(this.bodyReceiptCertificatePreviewUrl="data:image/jpg;base64,"+t.bodyReceiptCertificateImageURLBase64)}else this.error="Failed to load grave data";this.loading=!1},error:n=>{console.error("Error loading grave:",n),this.error="Failed to load grave data",this.loading=!1}})}onSubmit(){if(this.submitted=!0,this.error=null,this.graveForm.invalid)return;this.loading=!0;let e=this.graveForm.getRawValue();if(e.dateOfBirth){let t=new Date(e.dateOfBirth);t.setHours(12,0,0,0),e.dateOfBirth=t.toISOString()}if(e.dateOfDeath){let t=new Date(e.dateOfDeath);t.setHours(12,0,0,0),e.dateOfDeath=t.toISOString()}this.isEditMode&&this.graveId&&(e.graveId=String(this.graveId)),(this.isEditMode?this.graveService.putGrave(e):this.graveService.postGrave(e)).subscribe({next:t=>{if(t.success){this.success=!0;let m=this.isEditMode?this.translate.instant("GRAVE.EDIT_SUCCESS",{id:t.data.graveId,name:this.translate.currentLang==="ar"?t.data.fullNameAr:t.data.fullNameEn}):this.translate.instant("GRAVE.CREATE_SUCCESS",{id:t.data.graveId,name:this.translate.currentLang==="ar"?t.data.fullNameAr:t.data.fullNameEn});this.toast.success(m,this.translate.instant("COMMON.SUCCESS"));let x=t.data.graveId;if(this.selectedFile||this.selectedDeathCertificateFile||this.selectedBodyReceiptCertificateFile){let b=[];this.selectedFile&&b.push(this.uploadImage(t.data.graveId)),this.selectedDeathCertificateFile&&b.push(this.uploadDeathCertificateImage(t.data.graveId)),this.selectedBodyReceiptCertificateFile&&b.push(this.uploadBodyReceiptCertificateImage(t.data.graveId)),Promise.all(b).then(()=>{this.loading=!1,this.router.navigate(["/grave",x])})}else this.loading=!1,setTimeout(()=>{this.router.navigate(["/grave",x])},1e3)}else this.error=t.message||"Failed to save grave",this.toast.error(this.error),this.loading=!1},error:t=>{console.error("Error saving grave:",t),this.error="Failed to save grave data",this.toast.error(this.error),this.loading=!1}})}uploadImage(e){return new Promise(n=>{if(!this.selectedFile){n();return}let t={graveId:e,file:this.selectedFile};this.graveService.postImg(t).subscribe({next:()=>{this.toast.success(this.translate.instant("GRAVE.IMAGE_UPLOAD_SUCCESS"),this.translate.instant("COMMON.SUCCESS")),n()},error:m=>{console.error("Error uploading image:",m),this.toast.warning(this.translate.instant("GRAVE.IMAGE_UPLOAD_FAILED"),this.translate.instant("COMMON.WARNING")),n()}})})}uploadDeathCertificateImage(e){return new Promise(n=>{if(!this.selectedDeathCertificateFile){n();return}let t={graveId:e,file:this.selectedDeathCertificateFile};this.graveService.postDeathCertificateImg(t).subscribe({next:()=>{this.toast.success(this.translate.instant("GRAVE_FORM.DEATH_CERTIFICATE_UPLOAD_SUCCESS"),this.translate.instant("COMMON.SUCCESS")),n()},error:m=>{console.error("Error uploading death certificate:",m),this.toast.warning(this.translate.instant("GRAVE_FORM.DEATH_CERTIFICATE_UPLOAD_FAILED"),this.translate.instant("COMMON.WARNING")),n()}})})}uploadBodyReceiptCertificateImage(e){return new Promise(n=>{if(!this.selectedBodyReceiptCertificateFile){n();return}let t={graveId:e,file:this.selectedBodyReceiptCertificateFile};this.graveService.postBodyReceiptCertificateImg(t).subscribe({next:()=>{this.toast.success(this.translate.instant("GRAVE_FORM.BODY_RECEIPT_CERTIFICATE_UPLOAD_SUCCESS"),this.translate.instant("COMMON.SUCCESS")),n()},error:m=>{console.error("Error uploading body receipt certificate:",m),this.toast.warning(this.translate.instant("GRAVE_FORM.BODY_RECEIPT_CERTIFICATE_UPLOAD_FAILED"),this.translate.instant("COMMON.WARNING")),n()}})})}onFileSelected(e){let n=e.target;if(n.files&&n.files.length){let t=n.files[0];if(!t.type.match("image/jpeg")&&!t.type.match("image/jpg")){this.toast.error(this.translate.instant("GRAVE_FORM.INVALID_IMAGE_TYPE"));return}this.selectedFile=t,this.createImagePreview()}}onDeathCertificateFileSelected(e){let n=e.target;if(n.files&&n.files.length){let t=n.files[0];if(!t.type.match("image/jpeg")&&!t.type.match("image/jpg")){this.toast.error(this.translate.instant("GRAVE_FORM.INVALID_IMAGE_TYPE"));return}this.selectedDeathCertificateFile=t,this.createDeathCertificatePreview()}}onBodyReceiptCertificateFileSelected(e){let n=e.target;if(n.files&&n.files.length){let t=n.files[0];if(!t.type.match("image/jpeg")&&!t.type.match("image/jpg")){this.toast.error(this.translate.instant("GRAVE_FORM.INVALID_IMAGE_TYPE"));return}this.selectedBodyReceiptCertificateFile=t,this.createBodyReceiptCertificatePreview()}}createDeathCertificatePreview(){if(!this.selectedDeathCertificateFile){this.deathCertificatePreviewUrl=null;return}let e=new FileReader;e.onload=()=>{this.deathCertificatePreviewUrl=e.result},e.readAsDataURL(this.selectedDeathCertificateFile)}createBodyReceiptCertificatePreview(){if(!this.selectedBodyReceiptCertificateFile){this.bodyReceiptCertificatePreviewUrl=null;return}let e=new FileReader;e.onload=()=>{this.bodyReceiptCertificatePreviewUrl=e.result},e.readAsDataURL(this.selectedBodyReceiptCertificateFile)}createImagePreview(){if(!this.selectedFile)return;let e=new FileReader;e.onload=()=>{this.previewUrl=e.result},e.readAsDataURL(this.selectedFile)}onMarkerDragEnd(e){if(e.latLng){let n=e.latLng.lat(),t=e.latLng.lng();this.markerPosition={lat:n,lng:t},this.graveForm.patchValue({latitude:n,longitude:t})}}onMapClick(e){if(e.latLng){let n=e.latLng.lat(),t=e.latLng.lng();this.markerPosition={lat:n,lng:t},this.center={lat:n,lng:t},this.graveForm.patchValue({latitude:n,longitude:t})}}updateMapFromInputs(){let e=this.graveForm.get("latitude")?.getRawValue(),n=this.graveForm.get("longitude")?.getRawValue();if(e&&n&&!isNaN(e)&&!isNaN(n)){let t=Number(e),m=Number(n);this.markerPosition={lat:t,lng:m},this.center={lat:t,lng:m}}}useCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let n=e.coords.latitude,t=e.coords.longitude;this.markerPosition={lat:n,lng:t},this.center={lat:n,lng:t},this.graveForm.patchValue({latitude:n,longitude:t})},e=>{console.error("Geolocation error:",e),this.error="Unable to access your location. Please check browser permissions.",setTimeout(()=>this.error=null,5e3)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):(this.error="Geolocation is not supported by your browser.",setTimeout(()=>this.error=null,5e3))}searchLocation(e){if(!e.trim())return;if(!this.apiLoaded){this.error="Google Maps API is still loading. Please try again in a moment.",setTimeout(()=>this.error=null,5e3);return}new google.maps.Geocoder().geocode({address:e}).then(t=>{if(t.results&&t.results.length>0){let m=t.results[0].geometry.location,x=m.lat(),b=m.lng();this.markerPosition={lat:x,lng:b},this.center={lat:x,lng:b},this.graveForm.patchValue({latitude:x,longitude:b}),this.zoom=20}else this.error="Location not found. Please try another search.",setTimeout(()=>this.error=null,5e3)}).catch(t=>{console.error("Geocoding error:",t),this.error="Location search failed. Please try again.",setTimeout(()=>this.error=null,5e3)})}formatDate(e){let n=new Date(e);return n.setHours(12,0,0,0),n.toISOString().split("T")[0]}resetForm(){this.submitted=!1,this.graveForm.reset(),this.selectedFile=null,this.previewUrl=null,this.center={lat:23.60929544,lng:58.59319553},this.markerPosition={lat:23.60929544,lng:58.59319553},this.graveForm.patchValue({latitude:this.markerPosition.lat,longitude:this.markerPosition.lng})}loadGoogleMaps(){this.mapsApiService.loadApi().then(()=>{this.apiLoaded=!0,google&&google.maps&&(this.markerOptions.animation=google.maps.Animation.DROP)}).catch(e=>{console.error("Error loading Google Maps API:",e),this.error="Failed to load Google Maps",setTimeout(()=>this.error=null,5e3)})}static \u0275fac=function(n){return new(n||r)(E(ue),E(K),E(W),E(ge),E(le),E(Ce),E($),E(xe))};static \u0275cmp=A({type:r,selectors:[["app-grave-form"]],decls:15,vars:12,consts:[[1,"min-h-screen"],[1,"py-12","sm:py-20"],[1,"mx-auto","max-w-5xl","px-6","lg:px-8"],[1,"text-center","mb-10"],[1,"text-4xl","font-bold","tracking-tight","text-arabic-black","dark:text-gray-100","sm:text-5xl"],[1,"mt-6","text-lg","leading-8","text-gray-600","dark:text-gray-300"],["class","mt-12 text-center",4,"ngIf"],["class","mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",4,"ngIf"],["class","mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-700",4,"ngIf"],["class","bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8",4,"ngIf"],[1,"mt-12","text-center"],[1,"inline-block","h-8","w-8","animate-spin","rounded-full","border-4","border-solid","border-arabic-green","border-r-transparent","align-[-0.125em]","motion-reduce:animate-[spin_1.5s_linear_infinite]"],[1,"mt-4","text-gray-600","dark:text-gray-400"],[1,"mb-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-700"],[1,"mb-0"],[1,"mb-6","p-4","bg-green-50","border","border-green-200","rounded-lg","text-green-700"],[1,"bg-white","dark:bg-gray-800","rounded-xl","shadow-lg","p-6","mb-8"],[1,"space-y-6",3,"ngSubmit","formGroup"],[1,"text-xl","font-semibold","mb-4","pb-2","border-b","border-gray-200","dark:border-gray-700","text-arabic-black","dark:text-gray-100"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["id","refID","name","refID",3,"label","placeholder","formControl"],["id","zGenderId","name","zGenderId",3,"required","formControl"],["id","zZoneId","name","zZoneId",3,"required","formControl"],["id","zGraveTypeId","name","zGraveTypeId",3,"required","formControl"],["id","fullNameEn","name","fullNameEn",3,"label","required","placeholder","formControl"],["id","fullNameAr","name","fullNameAr",3,"label","required","placeholder","formControl"],[3,"label"],[3,"formControl","placeholder"],[3,"label","required"],[3,"required","formControl","placeholder"],["id","description","name","description",3,"label","rows","formControl","placeholder"],[1,"mt-4"],["id","descriptionEn","name","descriptionEn",3,"label","rows","formControl","placeholder"],["for","image",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2"],["for","deathCertificate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2","mt-4"],["for","deathCertificate",1,"inline-block","py-2","px-4","bg-arabic-green","text-white","rounded-md","text-sm","font-semibold","cursor-pointer","hover:bg-opacity-90"],["type","file","id","deathCertificate","accept",".jpg,.jpeg",1,"hidden","block","w-full","text-sm","text-gray-500","dark:text-gray-400","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-arabic-green","file:text-white","hover:file:bg-arabic-green-dark","file:cursor-pointer","dark:file:bg-arabic-green","dark:file:text-white",3,"change"],[1,"mt-1","text-xs","text-gray-500","dark:text-gray-400"],["class","flex justify-center items-center mt-2",4,"ngIf"],["for","bodyReceiptCertificate",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2","mt-4"],["for","bodyReceiptCertificate",1,"inline-block","py-2","px-4","bg-arabic-green","text-white","rounded-md","text-sm","font-semibold","cursor-pointer","hover:bg-opacity-90"],["type","file","id","bodyReceiptCertificate","accept",".jpg,.jpeg",1,"hidden","block","w-full","text-sm","text-gray-500","dark:text-gray-400","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-arabic-green","file:text-white","hover:file:bg-arabic-green-dark","file:cursor-pointer","dark:file:bg-arabic-green","dark:file:text-white",3,"change"],["for","image",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300","mb-2","mt-4"],["for","image",1,"inline-block","py-2","px-4","bg-arabic-green","text-white","rounded-md","text-sm","font-semibold","cursor-pointer","hover:bg-opacity-90"],["type","file","id","image","accept",".jpg,.jpeg",1,"hidden","block","w-full","text-sm","text-gray-500","dark:text-gray-400","file:mr-4","file:py-2","file:px-4","file:rounded-md","file:border-0","file:text-sm","file:font-semibold","file:bg-arabic-green","file:text-white","hover:file:bg-arabic-green-dark","file:cursor-pointer","dark:file:bg-arabic-green","dark:file:text-white",3,"change"],[1,"mb-4"],[1,"text-sm","text-gray-600","dark:text-gray-400","mb-2"],[1,"flex","items-end","mb-4"],[1,"flex-grow"],["type","search",3,"keyup.enter","placeholder","formControl"],["type","button",1,"h-10","px-4","-ml-[1px]","mt-auto","mb-[8px]","bg-arabic-green","text-white","cursor-pointer","rounded-r-md","hover:bg-opacity-90","focus:outline-none",3,"click"],["class","relative h-[400px] w-full rounded-lg overflow-hidden shadow-md bg-gray-100 dark:bg-gray-800 flex items-center justify-center",4,"ngIf"],["class","relative h-[400px] w-full rounded-lg overflow-hidden shadow-md",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mt-4"],["id","latitude","name","latitude","step","0.000001",3,"change","label","formControl","type"],["id","longitude","name","longitude","step","0.000001",3,"change","label","formControl","type"],[1,"flex","flex-col","sm:flex-row","gap-4","justify-end","pt-4"],[1,"btn","btn-secondary","order-2","sm:order-none","text-center","no-underline",3,"routerLink"],["type","submit",1,"btn","btn-primary","disabled:opacity-50","disabled:cursor-not-allowed","order-3","sm:order-none","cursor-pointer",3,"disabled"],[4,"ngIf"],["class","flex items-center justify-center",4,"ngIf"],[1,"flex","justify-center","items-center","mt-2"],["alt","Death Certificate Preview",1,"max-h-40","max-w-full","rounded-lg","shadow-md",3,"src"],["alt","Body Receipt Certificate Preview",1,"max-h-40","max-w-full","rounded-lg","shadow-md",3,"src"],["alt","Grave Image Preview",1,"max-h-40","max-w-full","rounded-lg","shadow-md",3,"src"],[1,"relative","h-[400px]","w-full","rounded-lg","overflow-hidden","shadow-md","bg-gray-100","dark:bg-gray-800","flex","items-center","justify-center"],[1,"text-center"],[1,"animate-spin","rounded-full","h-10","w-10","border-b-2","border-arabic-green","mx-auto","mb-4"],[1,"text-gray-500","dark:text-gray-400"],[1,"relative","h-[400px]","w-full","rounded-lg","overflow-hidden","shadow-md"],["height","400px","width","100%",3,"mapClick","center","zoom","options"],[3,"mapDragend","position","title"],["type","button",1,"absolute","top-4","right-4","z-10","p-2","bg-white","dark:bg-gray-700","rounded-full","shadow-md","hover:bg-gray-100","dark:hover:bg-gray-600","focus:outline-none","focus:ring-2","focus:ring-arabic-green",3,"click","title"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-arabic-green"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"],[1,"flex","items-center","justify-center"],[1,"h-4","w-4","mr-2","animate-spin","rounded-full","border-2","border-solid","border-white","border-r-transparent"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),p(5),s(6,"translate"),s(7,"translate"),a(),o(8,"p",5),p(9),s(10,"translate"),a()(),C(11,je,5,3,"div",6)(12,qe,3,1,"div",7)(13,He,5,5,"div",8)(14,$e,119,125,"div",9),a()()()),n&2&&(i(5),c(" ",t.isEditMode?d(6,6,"GRAVE_FORM.EDIT_TITLE"):d(7,8,"GRAVE_FORM.CREATE_TITLE")," "),i(4),c(" ",d(10,10,"APP.TAGLINE")," "),i(2),l("ngIf",t.loading),i(),l("ngIf",t.error),i(),l("ngIf",t.success),i(),l("ngIf",!t.loading||t.submitted))},dependencies:[S,F,P,re,G,ie,oe,k,ne,J,X,w,T,ve,fe,he,ce,Ee,_e,D,se,de,pe],styles:[`.gm-style .gm-style-iw-c{padding:12px!important}input[type=file][_ngcontent-%COMP%]::file-selector-button{margin-right:.5rem;border:none;background:var(--arabic-green);padding:.5rem 1rem;border-radius:.375rem;color:#fff;cursor:pointer;transition:background-color .2s ease-in-out}input[type=file][_ngcontent-%COMP%]::file-selector-button:hover{background:var(--arabic-green-dark)}@media (prefers-color-scheme: dark){input[type=date][_ngcontent-%COMP%]{color-scheme:dark}}
/*# sourceMappingURL=grave-form.component-CIKTTQ6I.css.map */`]})}return r})();export{St as GraveFormComponent};
//# sourceMappingURL=chunk-X2GFE6MO.mjs.map
