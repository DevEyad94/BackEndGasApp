import './polyfills.server.mjs';
import{l as m}from"./chunk-E44DUL6C.mjs";import{a as U}from"./chunk-KLHXEL3F.mjs";import{b as p}from"./chunk-VORNBINK.mjs";import{B as c,P as l,U as i,h as u,p as a,ta as f,wc as h}from"./chunk-IILPPODV.mjs";var C=(()=>{class s{http;router;baseUrl=U.apiUrl+"auth/";currentUserSource=new u(1);currentUser$=this.currentUserSource.asObservable();isBrowser;constructor(t,r,e){this.http=t,this.router=r,this.isBrowser=h(e),this.loadCurrentUser()}login(t){return this.http.post(this.baseUrl+"login",t).pipe(a(r=>{let e=r;return e.data&&(this.isBrowser&&localStorage.setItem("userInfo",JSON.stringify(e.data)),this.setCurrentUser(e.data)),r}))}loadCurrentUser(){if(!this.isBrowser){this.currentUserSource.next(null);return}let t=localStorage.getItem("userInfo");if(!t){this.currentUserSource.next(null);return}let r=JSON.parse(t);r.token&&!this.tokenExpired(r.token)?this.setCurrentUser(r):this.logout()}tokenExpired(t){try{let r=JSON.parse(atob(t.split(".")[1])).exp;return Math.floor(new Date().getTime()/1e3)>=r}catch{return!0}}logout(){this.isBrowser&&localStorage.removeItem("userInfo"),this.currentUserSource.next(null),this.router.navigate(["/"])}setCurrentUser(t){this.currentUserSource.next(t)}isLoggedIn(){if(!this.isBrowser)return!1;let t=localStorage.getItem("userInfo");if(!t)return!1;let r=JSON.parse(t);return!!r.token&&!this.tokenExpired(r.token)}resetPassword(t){return this.http.post(this.baseUrl+"RestPassword",t)}userExists(t){return this.http.get(this.baseUrl+"UserExists/"+t)}roleMatch(t){let r=!1;if(t){let e;this.currentUser$.pipe(c(1)).subscribe(o=>{e=o,e?.token&&t.forEach(g=>{let n=o?.role;n&&n.find(S=>S===g)&&(r=!0)})})}return r}static \u0275fac=function(r){return new(r||s)(i(p),i(m),i(f))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();export{C as a};
//# sourceMappingURL=chunk-UR4KZO5S.mjs.map
