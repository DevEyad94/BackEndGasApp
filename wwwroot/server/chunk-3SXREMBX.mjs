import './polyfills.server.mjs';
import{b as Z,c as J,d as W}from"./chunk-5VBOYX76.mjs";import{a as T,b as O,c as K}from"./chunk-Y4S57LZT.mjs";import"./chunk-UR4KZO5S.mjs";import"./chunk-E44DUL6C.mjs";import{a as Y,b as B,c as H,d as U}from"./chunk-MHCTP4LA.mjs";import{b as M,c as h,d as N,e as V,f as q,h as z,i as G,j as L,n as A,p as j,r as $}from"./chunk-444SJH6C.mjs";import"./chunk-KLHXEL3F.mjs";import"./chunk-VORNBINK.mjs";import{Ab as F,Cb as S,Eb as C,Fa as o,Ka as v,Pa as R,Ua as f,ba as b,bb as s,ca as x,fb as i,gb as r,hb as p,kb as y,lb as c,mb as m,oc as k,pc as w,rb as a,rc as E,sb as _,sc as D,tb as u,tc as I,z as P}from"./chunk-IILPPODV.mjs";import"./chunk-OFHM46N5.mjs";var Q=d=>[d];function X(d,g){if(d&1){let e=y();i(0,"div",33)(1,"h2",34),a(2),r(),i(3,"form",35),c("ngSubmit",function(){b(e);let t=m();return x(t.onSubmit())}),p(4,"input",36),i(5,"div"),p(6,"app-label",37)(7,"app-date-picker",38),r(),i(8,"div"),p(9,"app-zsk-select",39),r(),i(10,"div"),p(11,"app-text-input",40),r(),i(12,"div"),p(13,"app-text-input",41),r(),i(14,"div",42)(15,"button",43),c("click",function(){b(e);let t=m();return x(t.toggleForm())}),a(16," Cancel "),r(),i(17,"button",44),a(18),r()()()()}if(d&2){let e=m();o(2),u(" ",e.isEditMode?"Edit Production Record":"Add Production Record"," "),o(),s("formGroup",e.recordForm),o(3),s("label","Date of Production")("required",!0),o(),s("placeholder","Select date")("required",!0)("errorMessage","Date is required"),o(2),s("label","Field")("required",!0)("placeholder","Select field")("options",e.getFieldOptions())("id","field")("name","field"),o(2),s("label","Production Rate")("required",!0)("type","number")("placeholder","Enter production rate")("id","productionRate")("name","productionRate")("errorMessage","Production rate is required"),o(2),s("label","Production Cost")("required",!0)("type","number")("placeholder","Enter cost")("id","productionOfCost")("name","productionOfCost")("errorMessage","Production cost is required"),o(4),s("disabled",e.recordForm.invalid||e.isSubmitting),o(),u(" ",e.isSubmitting?"Saving...":e.isEditMode?"Update":"Save"," ")}}function ee(d,g){if(d&1&&(i(0,"span",45),a(1),r()),d&2){let e=m();o(),u(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function te(d,g){if(d&1&&(i(0,"span",45),a(1),r()),d&2){let e=m();o(),u(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function ie(d,g){if(d&1&&(i(0,"span",45),a(1),r()),d&2){let e=m();o(),u(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function re(d,g){if(d&1&&(i(0,"span",45),a(1),r()),d&2){let e=m();o(),u(" ",e.sortDirection==="asc"?"\u2191":"\u2193"," ")}}function oe(d,g){d&1&&(i(0,"tr",46)(1,"td",47),a(2," Loading... "),r()())}function ne(d,g){d&1&&(i(0,"tr",48)(1,"td",47),a(2," No records found "),r()())}function ae(d,g){if(d&1){let e=y();i(0,"button",54),c("click",function(){b(e);let t=m().$implicit,l=m();return x(l.deleteRecord(t))}),a(1," Delete "),r()}}function de(d,g){if(d&1){let e=y();i(0,"tr",48)(1,"td",49),a(2),S(3,"date"),r(),i(4,"td",50),a(5),r(),i(6,"td",49),a(7),r(),i(8,"td",49),a(9),S(10,"number"),r(),i(11,"td",51)(12,"button",52),c("click",function(){let t=b(e).$implicit,l=m();return x(l.editRecord(t))}),a(13," Edit "),r(),f(14,ae,2,0,"button",53),r()()}if(d&2){let e=g.$implicit,n=m();o(2),u(" ",C(3,5,e.dateOfProduction,"MMM d, yyyy")," "),o(3),u(" ",e.fieldName," "),o(2),u(" ",e.productionRate," "),o(2),u(" $",C(10,8,e.productionOfCost,"1.2-2")," "),o(5),s("appHasRole",F(11,Q,n.role.ADMIN))}}var Fe=(()=>{class d{gasService;zskService;fb;toastService;Math=Math;role=O;productionRecords=[];pagination={currentPage:1,itemsPerPage:10,totalItems:0,totalPages:0};fields=[];recordForm;filterForm;isEditMode=!1;selectedRecord=null;isLoading=!1;isFormVisible=!1;isSubmitting=!1;sortColumn="dateOfProduction";sortDirection="desc";selectedFile=null;importMessage="";subscriptions=[];fieldOptions=[];showDeleteConfirmation=!1;recordToDelete=null;constructor(e,n,t,l){this.gasService=e,this.zskService=n,this.fb=t,this.toastService=l}ngOnInit(){this.initForms(),this.loadFilterOptions(),setTimeout(()=>{this.loadRecords()},100)}initForms(){this.recordForm=this.fb.group({productionRecordGuid:[""],dateOfProduction:["",h.required],productionOfCost:[0,[h.required,h.min(0)]],productionRate:[0,[h.required,h.min(0)]],zFieldId:[null,h.required]}),this.filterForm=this.fb.group({search:[""],startDate:[""],endDate:[""],zFieldId:[null],minProductionRate:[null],maxProductionRate:[null],year:[null]});let e=this.filterForm.valueChanges.pipe(P(500)).subscribe(()=>{this.pagination.currentPage=1,this.loadRecords()});this.subscriptions.push(e)}loadFilterOptions(){this.zskService.getFields().subscribe({next:e=>{this.fields=e,this.fieldOptions=this.fields.map(n=>({value:n.zFieldId,label:n.name}))},error:e=>{console.error("Error fetching fields:",e),this.toastService.error("Failed to load fields. Please try again later.")}})}loadRecords(){this.isLoading=!0;let e=this.filterForm.value;this.gasService.getProductionRecordsWithFilter(e,this.pagination.currentPage,this.pagination.itemsPerPage,this.sortColumn,this.sortDirection).subscribe({next:n=>{this.productionRecords=n.result.data||[],this.pagination=n.pagination,this.isLoading=!1},error:n=>{console.error("Error fetching production records:",n),this.isLoading=!1,this.toastService.error("Failed to load production records. Please try again later.")}})}onPageChange(e){this.pagination.currentPage=e,this.loadRecords()}onSort(e){this.sortColumn===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=e,this.sortDirection="asc"),this.loadRecords()}toggleForm(e=!1){this.isFormVisible=!this.isFormVisible,this.isFormVisible&&!this.isEditMode?this.resetForm():this.isFormVisible||this.resetForm()}resetForm(){this.recordForm.reset({productionRecordGuid:"",productionOfCost:0,productionRate:0,zFieldId:null}),this.isEditMode=!1,this.selectedRecord=null}onSubmit(){if(this.recordForm.invalid){this.markFormGroupTouched(this.recordForm),this.toastService.warning("Please fill in all required fields correctly.");return}this.isSubmitting=!0;let e=this.recordForm.value;if(this.isEditMode&&this.selectedRecord){let n={productionRecordGuid:e.productionRecordGuid,dateOfProduction:e.dateOfProduction,productionOfCost:e.productionOfCost,productionRate:e.productionRate,zFieldId:e.zFieldId};this.gasService.updateProductionRecord(n).subscribe({next:()=>{this.onSubmitSuccess("Production record updated successfully!")},error:t=>{console.error("Error updating record:",t),this.isSubmitting=!1,this.toastService.error("Failed to update production record. Please try again.")}})}else{let n={dateOfProduction:e.dateOfProduction,productionOfCost:e.productionOfCost,productionRate:e.productionRate,zFieldId:e.zFieldId};this.gasService.addProductionRecord(n).subscribe({next:()=>{this.onSubmitSuccess("Production record added successfully!")},error:t=>{console.error("Error adding record:",t),this.isSubmitting=!1,this.toastService.error("Failed to add production record. Please try again.")}})}}onSubmitSuccess(e){this.loadRecords(),this.resetForm(),this.isFormVisible=!1,this.isSubmitting=!1,this.toastService.success(e)}editRecord(e){this.isEditMode=!0,this.selectedRecord=e,this.isFormVisible||(this.isFormVisible=!0),this.recordForm.patchValue({productionRecordGuid:e.productionRecordGuid,dateOfProduction:this.formatDateForInput(e.dateOfProduction),productionOfCost:e.productionOfCost,productionRate:e.productionRate,zFieldId:e.zFieldId})}showDeleteConfirmationDialog(e){this.recordToDelete=e,this.showDeleteConfirmation=!0}onConfirmDelete(){this.recordToDelete&&this.performDeleteRecord(this.recordToDelete),this.showDeleteConfirmation=!1,this.recordToDelete=null}onCancelDelete(){this.showDeleteConfirmation=!1,this.recordToDelete=null}deleteRecord(e){this.showDeleteConfirmationDialog(e)}performDeleteRecord(e){this.gasService.deleteProductionRecord(e.productionRecordGuid).subscribe({next:()=>{this.loadRecords(),this.toastService.success(`Production record for ${e.fieldName} has been deleted.`)},error:n=>{console.error("Error deleting record:",n),this.toastService.error("Failed to delete production record. Please try again.")}})}onFileSelected(e){let n=e.target;n.files&&n.files.length&&(this.selectedFile=n.files[0])}uploadFile(){if(!this.selectedFile){this.toastService.warning("Please select a file first.");return}this.isLoading=!0,this.importMessage="",this.gasService.importProductionRecords(this.selectedFile).subscribe({next:e=>{this.importMessage=`Successfully imported ${e} records.`,this.loadRecords(),this.isLoading=!1,this.selectedFile=null;let n=document.getElementById("fileInput");n&&(n.value=""),this.toastService.success(`Successfully imported ${e} production records.`)},error:e=>{console.error("Error importing records:",e),this.importMessage="Error importing records. Please check the file format.",this.isLoading=!1,this.toastService.error("Failed to import records. Please check the file format and try again.")}})}formatDateForInput(e){return new Date(e).toISOString().split("T")[0]}getFieldName(e){let n=this.fields.find(t=>t.zFieldId===e);return n?n.name:"Unknown"}markFormGroupTouched(e){Object.values(e.controls).forEach(n=>{n.markAsTouched(),n instanceof q&&this.markFormGroupTouched(n)})}getFieldOptions(){return this.fieldOptions}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}static \u0275fac=function(n){return new(n||d)(v(W),v(U),v(j),v(K))};static \u0275cmp=R({type:d,selectors:[["app-production-records"]],decls:70,vars:35,consts:[[1,"p-4","bg-gray-50","dark:bg-gray-800","min-h-screen"],[1,"mb-6","flex","justify-between","items-center"],[1,"text-3xl","font-bold","text-gray-900","dark:text-white"],[1,"mt-1","text-gray-600","dark:text-gray-300"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-green-500",3,"click"],["class","bg-white dark:bg-gray-700 p-6 rounded-lg shadow mb-6",4,"ngIf"],[1,"bg-white","dark:bg-gray-700","p-4","rounded-lg","shadow","mb-6"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","lg:grid-cols-6","gap-4",3,"formGroup"],["formControlName","search",3,"label","placeholder"],["formControlName","zFieldId",3,"label","placeholder","options"],[3,"label"],["formControlName","startDate",3,"placeholder"],["formControlName","endDate",3,"placeholder"],["formControlName","minProductionRate",3,"label","type","placeholder"],["formControlName","year",3,"label","type","placeholder"],[1,"bg-white","dark:bg-gray-700","rounded-lg","shadow","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200","dark:divide-gray-600"],[1,"bg-gray-50","dark:bg-gray-800"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider","cursor-pointer",3,"click"],["class","ml-1",4,"ngIf"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","dark:text-gray-300","uppercase","tracking-wider"],[1,"bg-white","dark:bg-gray-700","divide-y","divide-gray-200","dark:divide-gray-600"],["class","animate-pulse",4,"ngIf"],["class","hover:bg-gray-100 dark:hover:bg-gray-600",4,"ngIf"],["class","hover:bg-gray-100 dark:hover:bg-gray-600",4,"ngFor","ngForOf"],[1,"px-6","py-3","flex","items-center","justify-between","border-t","border-gray-200","dark:border-gray-600"],[1,"text-sm","text-gray-700","dark:text-gray-300"],[1,"font-medium"],[1,"flex","space-x-2"],[1,"px-3","py-1","border","border-gray-300","rounded-md","text-gray-700","hover:bg-gray-50","dark:border-gray-600","dark:text-gray-300","dark:hover:bg-gray-600","disabled:opacity-50",3,"click","disabled"],[3,"confirm","cancel","visible","title","message","confirmText","cancelText"],[1,"bg-white","dark:bg-gray-700","p-6","rounded-lg","shadow","mb-6"],[1,"text-xl","font-semibold","text-gray-800","dark:text-white","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6",3,"ngSubmit","formGroup"],["type","hidden","formControlName","productionRecordGuid"],[3,"label","required"],["formControlName","dateOfProduction",3,"placeholder","required","errorMessage"],["formControlName","zFieldId",3,"label","required","placeholder","options","id","name"],["formControlName","productionRate",3,"label","required","type","placeholder","id","name","errorMessage"],["formControlName","productionOfCost",3,"label","required","type","placeholder","id","name","errorMessage"],[1,"md:col-span-2","flex","justify-end"],["type","button",1,"mr-2","px-4","py-2","border","border-gray-300","text-gray-700","rounded-md","hover:bg-gray-50","dark:border-gray-600","dark:text-gray-300","dark:hover:bg-gray-600",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500","disabled:opacity-50",3,"disabled"],[1,"ml-1"],[1,"animate-pulse"],["colspan","5",1,"px-6","py-4","whitespace-nowrap","text-center","text-gray-500","dark:text-gray-300"],[1,"hover:bg-gray-100","dark:hover:bg-gray-600"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500","dark:text-gray-300"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium","text-gray-900","dark:text-white"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-right","space-x-1"],[1,"px-3","py-1.5","text-xs","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-blue-500",3,"click"],["class","px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",3,"click",4,"appHasRole"],[1,"px-3","py-1.5","text-xs","bg-red-600","text-white","rounded-md","hover:bg-red-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-red-500",3,"click"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),a(4," Production Records "),r(),i(5,"p",3),a(6," Manage gas condensate production records "),r()(),i(7,"div")(8,"button",4),c("click",function(){return t.toggleForm()}),a(9),r()()(),f(10,X,19,29,"div",5),i(11,"div",6)(12,"h2",7),a(13," Filter Records "),r(),i(14,"form",8)(15,"div"),p(16,"app-text-input",9),r(),i(17,"div"),p(18,"app-zsk-select",10),r(),i(19,"div"),p(20,"app-label",11)(21,"app-date-picker",12),r(),i(22,"div"),p(23,"app-label",11)(24,"app-date-picker",13),r(),i(25,"div"),p(26,"app-text-input",14),r(),i(27,"div"),p(28,"app-text-input",15),r()()(),i(29,"div",16)(30,"div",17)(31,"table",18)(32,"thead",19)(33,"tr")(34,"th",20),c("click",function(){return t.onSort("dateOfProduction")}),a(35," Date "),f(36,ee,2,1,"span",21),r(),i(37,"th",20),c("click",function(){return t.onSort("fieldName")}),a(38," Field "),f(39,te,2,1,"span",21),r(),i(40,"th",20),c("click",function(){return t.onSort("productionRate")}),a(41," Production Rate "),f(42,ie,2,1,"span",21),r(),i(43,"th",20),c("click",function(){return t.onSort("productionOfCost")}),a(44," Cost "),f(45,re,2,1,"span",21),r(),i(46,"th",22),a(47," Actions "),r()()(),i(48,"tbody",23),f(49,oe,3,0,"tr",24)(50,ne,3,0,"tr",25)(51,de,15,13,"tr",26),r()()(),i(52,"div",27)(53,"div",28),a(54," Showing "),i(55,"span",29),a(56),r(),a(57," to "),i(58,"span",29),a(59),r(),a(60," of "),i(61,"span",29),a(62),r(),a(63," results "),r(),i(64,"div",30)(65,"button",31),c("click",function(){return t.onPageChange(t.pagination.currentPage-1)}),a(66," Previous "),r(),i(67,"button",31),c("click",function(){return t.onPageChange(t.pagination.currentPage+1)}),a(68," Next "),r()()()(),i(69,"app-confirm-dialog",32),c("confirm",function(){return t.onConfirmDelete()})("cancel",function(){return t.onCancelDelete()}),r()()),n&2&&(o(9),u(" ",t.isFormVisible?"Cancel":"Add New Record"," "),o(),s("ngIf",t.isFormVisible),o(4),s("formGroup",t.filterForm),o(2),s("label","Search")("placeholder","Search..."),o(2),s("label","Field")("placeholder","All fields")("options",t.getFieldOptions()),o(2),s("label","Start Date"),o(),s("placeholder","Select start date"),o(2),s("label","End Date"),o(),s("placeholder","Select end date"),o(2),s("label","Min Production Rate")("type","number")("placeholder","Min"),o(2),s("label","Year")("type","number")("placeholder","YYYY"),o(8),s("ngIf",t.sortColumn==="dateOfProduction"),o(3),s("ngIf",t.sortColumn==="fieldName"),o(3),s("ngIf",t.sortColumn==="productionRate"),o(3),s("ngIf",t.sortColumn==="productionOfCost"),o(4),s("ngIf",t.isLoading),o(),s("ngIf",!t.isLoading&&(!t.productionRecords||t.productionRecords.length===0)),o(),s("ngForOf",t.productionRecords),o(5),_((t.pagination.currentPage-1)*t.pagination.itemsPerPage+1),o(3),_(t.Math.min(t.pagination.currentPage*t.pagination.itemsPerPage,t.pagination.totalItems)),o(3),_(t.pagination.totalItems),o(3),s("disabled",t.pagination.currentPage===1),o(2),s("disabled",t.pagination.currentPage===t.pagination.totalPages),o(2),s("visible",t.showDeleteConfirmation)("title","Confirm Delete")("message",t.recordToDelete?"Are you sure you want to delete the production record for "+t.recordToDelete.fieldName+"?":"Are you sure you want to delete this record?")("confirmText","Delete")("cancelText","Cancel"))},dependencies:[I,k,w,D,E,$,z,M,N,V,A,G,L,B,Z,Y,H,J,T],styles:[`.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}@media (max-width: 640px){.whitespace-nowrap[_ngcontent-%COMP%]{white-space:normal}}
/*# sourceMappingURL=production-records.component-N3J372ST.css.map */`]})}return d})();export{Fe as ProductionRecordsComponent};
//# sourceMappingURL=chunk-3SXREMBX.mjs.map
